{% extends 'base.html' %}
{% block content %}
<h2>Admin Panel</h2>
<p><a class="btn" href="{{ url_for('admin_logout') }}">Log out</a></p>

<section class="grid2">
  <div class="card">
    <h3>Pending Posts</h3>
    <ul class="notes">
      {% for n in pending %}
      <li class="note">
        <div class="note-top">
          <span class="giver">{{ n.giver_name or 'Anonymous' }} {% if n.giver_type=='student' and n.giver_section %}• {{ n.giver_section.label() }}{% endif %}</span>
          <span class="time">{{ n.created_at.strftime('%b %d, %Y %I:%M %p') }}</span>
        </div>
        <div class="note-mid">
          {% if n.receiver_type == 'student' %}
            <span class="to">→ {{ n.receiver_name_text }}{% if n.receiver_section %} ({{ n.receiver_section.label() }}){% endif %}</span>
          {% elif n.receiver_type == 'teacher' and n.receiver_teacher %}
            <span class="to">→ {{ n.receiver_teacher.name }} ({{ n.receiver_teacher.subject }})</span>
          {% elif n.receiver_type == 'staff' and n.receiver_staff %}
            <span class="to">→ {{ n.receiver_staff.name }} ({{ n.receiver_staff.role }})</span>
          {% endif %}
        </div>
        <p class="msg">{{ n.message }}</p>
        <p>
          <a class="approve" href="{{ url_for('admin_note_action', nid=n.id, action='approve') }}">Approve</a>
          <a class="hide" href="{{ url_for('admin_note_action', nid=n.id, action='hide') }}">Hide</a>
          <a class="hide" href="{{ url_for('admin_delete', nid=n.id) }}" onclick="return confirm('Delete permanently?')">Delete</a>
        </p>
      </li>
      {% else %}
      <li>No pending posts.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card">
    <h3>Approved Posts</h3>
    <ul class="notes">
      {% for n in approved %}
      <li class="note">
        <div class="note-top">
          <span class="giver">{{ n.giver_name or 'Anonymous' }} {% if n.giver_type=='student' and n.giver_section %}• {{ n.giver_section.label() }}{% endif %}</span>
          <span class="time">{{ n.created_at.strftime('%b %d, %Y %I:%M %p') }}</span>
        </div>
        <div class="note-mid">
          {% if n.receiver_type == 'student' %}
            <span class="to">→ {{ n.receiver_name_text }}{% if n.receiver_section %} ({{ n.receiver_section.label() }}){% endif %}</span>
          {% elif n.receiver_type == 'teacher' and n.receiver_teacher %}
            <span class="to">→ {{ n.receiver_teacher.name }} ({{ n.receiver_teacher.subject }})</span>
          {% elif n.receiver_type == 'staff' and n.receiver_staff %}
            <span class="to">→ {{ n.receiver_staff.name }} ({{ n.receiver_staff.role }})</span>
          {% endif %}
        </div>
        <p class="msg">{{ n.message }}</p>
        <p>
          <a class="hide" href="{{ url_for('admin_note_action', nid=n.id, action='hide') }}">Hide</a>
          <a class="hide" href="{{ url_for('admin_delete', nid=n.id) }}" onclick="return confirm('Delete permanently?')">Delete</a>
        </p>
      </li>
      {% else %}
      <li>No approved posts yet.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card">
    <h3>Hidden Posts</h3>
    <ul class="notes">
      {% for n in hidden %}
      <li class="note">
        <div class="note-top">
          <span class="giver">{{ n.giver_name or 'Anonymous' }} {% if n.giver_type=='student' and n.giver_section %}• {{ n.giver_section.label() }}{% endif %}</span>
          <span class="time">{{ n.created_at.strftime('%b %d, %Y %I:%M %p') }}</span>
        </div>
        <div class="note-mid">
          {% if n.receiver_type == 'student' %}
            <span class="to">→ {{ n.receiver_name_text }}{% if n.receiver_section %} ({{ n.receiver_section.label() }}){% endif %}</span>
          {% elif n.receiver_type == 'teacher' and n.receiver_teacher %}
            <span class="to">→ {{ n.receiver_teacher.name }} ({{ n.receiver_teacher.subject }})</span>
          {% elif n.receiver_type == 'staff' and n.receiver_staff %}
            <span class="to">→ {{ n.receiver_staff.name }} ({{ n.receiver_staff.role }})</span>
          {% endif %}
        </div>
        <p class="msg">{{ n.message }}</p>
        <p>
          <a class="approve" href="{{ url_for('admin_note_action', nid=n.id, action='unhide') }}">Unhide</a>
          <a class="hide" href="{{ url_for('admin_delete', nid=n.id) }}" onclick="return confirm('Delete permanently?')">Delete</a>
        </p>
      </li>
      {% else %}
      <li>No hidden posts.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card">
    <h3>Add Class–Section</h3>
    <form method="post">
      <input type="hidden" name="form" value="section">
      <div class="row">
        <input name="class_name" placeholder="Class (e.g., 7)" required>
        <input name="section_name" placeholder="Section (e.g., A)" required>
      </div>
      <button type="submit">Add Section</button>
    </form>

    <h4>Existing Sections</h4>
    <ul class="list">
      {% for s in sections %}<li>{{ s.label() }}</li>{% else %}<li>None yet.</li>{% endfor %}
    </ul>
  </div>

  <div class="card">
    <h3>Add Teacher</h3>
    <form method="post">
      <input type="hidden" name="form" value="teacher">
      <div class="row">
        <input name="teacher_name" placeholder="Full name" required>
        <input name="teacher_subject" placeholder="Subject" required>
      </div>
      <button type="submit">Add Teacher</button>
    </form>

    <h4>Existing Teachers</h4>
    <ul class="list">
      {% for t in teachers %}<li>{{ t.name }} — {{ t.subject }}</li>{% else %}<li>None yet.</li>{% endfor %}
    </ul>
  </div>
</section>
{% endblock %}
