{% extends 'base.html' %}
{% block content %}
<h2>Full Leaderboard</h2>

<div class="bar-tabs">
  <button class="active" data-bar="teachers">Teachers</button>
  <button data-bar="students">Students</button>
  <button data-bar="staffs">Staffs</button>
</div>

<div class="bars">
  {% for key in ['teachers','students','staffs'] %}
  <div class="bar-panel {% if loop.first %}active{% endif %}" id="bars-{{key}}">
    <div class="bargrid with-divider">
      <div class="bar-head">
        <div class="bar-col name">Name</div>
        <div class="bar-col pos">Position</div>
      </div>
      {% for item in bars[key] %}
      <div class="bar-row">
        <div class="bar-col name">
          {% if loop.index == 1 %}<span class="badge gold">1</span>{% elif loop.index == 2 %}<span class="badge silver">2</span>{% elif loop.index == 3 %}<span class="badge bronze">3</span>{% endif %}
          {{ item.label }}
          {% if loop.index in [1,2,3] %}
            {% if key=='teachers' %}
              <a class="smalllink" href="{{ url_for('certificate', category='teacher', rank=loop.index) }}">Certificate</a>
            {% elif key=='staffs' %}
              <a class="smalllink" href="{{ url_for('certificate', category='staff', rank=loop.index) }}">Certificate</a>
            {% else %}
              <a class="smalllink" href="{{ url_for('certificate', category='student_section', rank=loop.index) }}">Certificate</a>
            {% endif %}
          {% endif %}
        </div>
        <div class="bar-col pos">
          <div class="bar">
            <div class="bar-fill" style="width: {{ item.pct }}%">
              <span class="bar-label">{{ item.pct }}%</span>
            </div>
          </div>
        </div>
      </div>
      {% else %}
      <div class="muted" style="padding:10px 0">No data yet</div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>

<section class="grid2">
  <div class="card">
    <h3>Top Appreciators (Class–Section)</h3>
    <ol>
      {% for sec_id, pts in top_appreciators_section %}
        <li>{{ sec_label(sec_id) }} — {{ pts }} pts</li>
      {% else %}
        <li>No data yet.</li>
      {% endfor %}
    </ol>
  </div>
  <div class="card">
    <h3>Top Appreciated (Class–Section)</h3>
    <ol>
      {% for sec_id, cnt in top_appreciated_section %}
        <li>{{ sec_label(sec_id) }} — {{ cnt }} thanks</li>
      {% else %}
        <li>No data yet.</li>
      {% endfor %}
    </ol>
  </div>
  <div class="card">
    <h3>Top Teachers</h3>
    <ol>
      {% for tid, cnt in top_teachers %}
        <li>{{ teacher_label(tid) }} — {{ cnt }} thanks</li>
      {% else %}
        <li>No data yet.</li>
      {% endfor %}
    </ol>
  </div>
</section>

<script>
  const bTabs = document.querySelectorAll('.bar-tabs button');
  const bPanels = document.querySelectorAll('.bar-panel');
  bTabs.forEach(btn=>{
    btn.addEventListener('click',()=>{
      bTabs.forEach(b=>b.classList.remove('active'));
      bPanels.forEach(p=>p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('bars-'+btn.dataset.bar).classList.add('active');
    });
  });
</script>
{% endblock %}
